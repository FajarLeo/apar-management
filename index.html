<!DOCTYPE html>
<html lang="id">
<head>
 <link rel="icon" href="Logo.png" type="image/png">
  <meta charset="UTF-8">
  <title>Login - Dashboard APAR</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .left {
      flex: 1;
      background-image: url('tkk.jpeg');
      background-size: cover;
      background-position: center;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px;
      text-align: center;
      position: relative;
    }

    .left p {
      font-size: 15px;
      line-height: 1.6;
      max-width: 380px;
      margin-bottom: 25px;
    }

      .left img {
      max-width: 150px;
      height: auto;
      margin-bottom: 20px; /* jarak antara gambar dan teks */
      top: auto;
    }


    .right {
      flex: 1;
      background-image: url('bg.jpg');
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .right img {
      max-width: 150px;
      height: auto;
      position: relative;
      align-items: center;
      top: -60px; 
      
    }

     .right h2 {
      font-size: 60px;
      font-weight: 700;
      margin-bottom: 10px;
      font-family: Georgia, 'Times New Roman', Times, serif;
    }

    .login-box {
      padding: 40px 50px;
      border-radius: 20px;
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-box h2 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      background: #f3f3f3;
    }

    .input-group input:focus {
      border-color: #0b1e70;
      outline: none;
      background: #fff;
    }

    button.login {
      width: 100%;
      padding: 12px;
      background: #c9302c;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: 0.3s;
    }

    button.login:hover {
      background: #d9534f;
    }

    .forgot {
      margin-top: 12px;
      font-size: 13px;
    }

    .forgot a {
      color: #0b1e70;
      text-decoration: none;
    }

    .forgot a:hover {
      text-decoration: underline;
    }

    .error {
      color: red;
      font-size: 13px;
      margin-top: 10px;
    }

    @media (max-width: 900px) {
      body {
        flex-direction: column;
      }

      .left {
        padding: 40px 20px;
      }

      .left img {
        display: none;
      }
    }
/* === Mobile Responsive Login Page === */
@media (max-width: 768px) {
  body {
    flex-direction: column;   /* ubah layout jadi vertikal */
    height: auto;
    overflow: auto;
  }

  .left {
    flex: none;
    width: 100%;
    height: 200px;            /* tinggi lebih kecil */
    padding: 20px;
    background-position: center;
  }

  .left img {
    max-width: 100px;
    margin-bottom: 10px;
  }

  .right {
    flex: none;
    width: 100%;
    min-height: calc(100vh - 200px);
    padding: 20px;
    background-size: cover;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .login-box {
    width: 100%;
    max-width: 100%;
    padding: 20px;
    margin-top: 20px;
    border-radius: 12px;
    background: rgba(255,255,255,0.9); /* biar teks jelas */
  }

  .right h2 {
    font-size: 24px;   /* kecilkan judul */
    line-height: 1.3;
  }

  .right img {
    max-width: 100px;
    top: 0;
    margin-bottom: 10px;
  }

  button.login {
    font-size: 16px;
    padding: 14px;
  }

  footer {
    position: static !important; /* biar tidak menimpa */
    margin-top: 20px;
    font-size: 11px;
  }
}

/* Reset password box */
#forgotForm {
  display: none;
  margin-top: 20px;
  padding: 15px;
  border-radius: 10px;
  background: rgba(255,255,255,0.9);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  text-align: left;
}

#forgotForm input {
  width: 100%;
  padding: 10px;
  margin-bottom: 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}

#forgotForm button {
  width: 100%;
  padding: 10px;
  background: #0b1e70;
  color: white;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}

#forgotForm button:hover {
  background: #1333a1;
}

#forgotMsg {
  margin-top: 10px;
  font-size: 13px;
  font-weight: 500;
}

.forgot a {
  cursor: pointer;
  color:#333
}

.forgot a :hover {
  cursor: pointer;
  color:rgb(42, 42, 204)
}
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
}
.modal-content {
  background: #fff;
  margin: 5% auto;
  padding: 25px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  position: relative;
}
.close {
  position: absolute;
  top: 10px; right: 15px;
  font-size: 20px;
  cursor: pointer;
}
.close:hover { color: red; }

.modal-input {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}

.modal-btn {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
}
.modal-btn.blue { background: #007bff; color: white; }
.modal-btn.red { background: #dc3545; color: white; }
.modal-btn.green { background: #28a745; color: white; }

.modal-msg {
  margin-top: 8px;
  font-size: 13px;
  font-weight: 500;
}

.slide-section {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease;
}
.slide-section.show {
  max-height: 500px;
}

.modal-content img {
  max-width: 100px;
  height: auto;
  top: auto;
}
@media (max-width: 500px) {
  .modal-content {
    padding: 15px;
  }
  .modal-content img {
    max-width: 80px;
  }
}
.modal-title {
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  color: #333;   /* biru tua */
  margin-bottom: 15px;
  position: relative;
  font-family: "bauhaus 93", sans-serif;
  text-transform: uppercase;
}

.modal-title::after {
  content: "";
  display: block;
  width: 50px;
  height: 3px;
  background: #007bff; /* garis biru */
  margin: 8px auto 0;
  border-radius: 2px;
}


  </style>
</head>
<body>

  <div class="left">
   <img src="dsngroup1.PNG" alt="Damkar Teka Logo">
  </div>

  <div class="right">
    <div class="login-box">
      <img src="teka.png" alt="Damkar Teka Logo">
      <h2>TEKA Fire Department Management System</h2>
      <div class="input-group">
        <input type="text" id="npk" placeholder="NPK">
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="Password">
      </div>
      <button class="login" id="loginBtn">SIGN ME IN</button>
      <div class="forgot">
        <a id="forgotLink">Forgot Password?</a>
 <div id="forgotModal" class="modal" role="dialog" aria-label="Reset Password">
  <div class="modal-content">
    <span class="close" title="Tutup">&times;</span>
    <h3 class="modal-title">Reset Password</h3>

    <!-- Logo -->
    <div style="display:flex; justify-content:center; align-items:center; gap:20px; margin-bottom:10px;">
      <img src="dsngroup.png" alt="DSN Group" style="max-height:60px;">
      <img src="teka.png" alt="TEKA" style="max-height:60px;">
    </div>
    <!-- Input NPK -->
    <input type="text" id="forgotNPK" placeholder="Your NPK" class="modal-input">

    <!-- Tombol Reset ke Admin -->
    <button id="resetBtn" class="modal-btn blue">Send Your Request</button>
    <div id="forgotMsg" class="modal-msg"></div>

    <!-- Tombol Toggle Ganti Password -->
    <button id="toggleChange" class="modal-btn red">Change Password</button>

    <!-- Form Ganti Password -->
    <div id="changeSection" class="slide-section">
      <input type="password" id="oldPass" placeholder=" Old Password" class="modal-input">
      <input type="password" id="newPass" placeholder=" New Password" class="modal-input">
      <button id="changeBtn" class="modal-btn green">Save New Password</button>
      <div id="changeMsg" class="modal-msg"></div>
    </div>
  </div>
</div>

      </div>
      <div id="errorMsg" class="error"></div>
    <footer style="position: absolute; bottom:10px; font-size:12px; font-family:'Courier New',Courier,monospace; color:#333; text-align:center; width:100%;">&copy; Be Spirit Copyright 2025</footer>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
import { getDatabase, ref, get, child, set, update } 
  from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAoZPIGUuCZxosN5m2LFirk9Spf7c9QZrA",
  authDomain: "be-spirit-project.firebaseapp.com",
  databaseURL: "https://be-spirit-project-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "be-spirit-project",
  storageBucket: "be-spirit-project.appspot.com",
  messagingSenderId: "518798108329",
  appId: "1:518798108329:web:f3a64e05dbb1c20751ebb8",
  measurementId: "G-55M6SPB3QM"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Login
document.getElementById("loginBtn").addEventListener("click", async () => {
  const npk = document.getElementById("npk").value.trim();
  const password = document.getElementById("password").value.trim();
  const errorMsg = document.getElementById("errorMsg");

  if(!npk || !password){
    errorMsg.textContent = "⚠️ NPK dan Password wajib diisi!";
    return;
  }

  const dbRef = ref(db);

  try {
    const snapshot = await get(child(dbRef, `users/${npk}`));
    if(snapshot.exists()){
      const user = snapshot.val();
      if(user.password === password){
        localStorage.setItem("userNPK", npk);
        localStorage.setItem("userName", user.username);
        localStorage.setItem("userStatus", user.status);
        window.location.href = "home.html";
      } else {
        errorMsg.textContent = "❌ Password salah.";
      }
    } else {
      errorMsg.textContent = "❌ NPK tidak ditemukan.";
    }
  } catch(error){
    errorMsg.textContent = "⚠️ Gagal terhubung: " + error.message;
    alert("Error Firebase: " + error.message);
    console.error(error);
  }
});

// Show modal when forgot password clicked
document.getElementById("forgotLink").addEventListener("click", () => {
  document.getElementById("forgotModal").style.display = "block";
});

// Close modal
document.querySelector(".close").addEventListener("click", () => {
  document.getElementById("forgotModal").style.display = "none";
});

// Tampilkan modal saat klik Forgot Password
document.getElementById("forgotLink").addEventListener("click", () => {
  document.getElementById("forgotModal").style.display = "block";
});

// Tutup modal saat klik X
document.querySelector(".close").addEventListener("click", () => {
  document.getElementById("forgotModal").style.display = "none";
});

// Toggle form ganti password
document.getElementById("toggleChange").addEventListener("click", () => {
  const section = document.getElementById("changeSection");
  section.classList.toggle("show");
});


// Kirim permintaan reset ke admin
document.getElementById("resetBtn").addEventListener("click", async () => {
  const npk = document.getElementById("forgotNPK").value.trim();
  const msg = document.getElementById("forgotMsg");

  if(!npk){ 
    msg.style.color="red"; 
    msg.textContent="⚠️ NPK wajib diisi!"; 
    return; 
  }

  try {
    const snapshot = await get(child(ref(db), `users/${npk}`));
    if(snapshot.exists()){
      const user = snapshot.val();

      // ✅ simpan username juga ke resetRequests
      await set(ref(db, `resetRequests/${npk}`), {
        username: user.username || "-",   // tambahkan username
        requestedAt: new Date().toISOString(),
        status: "pending"
      });

      msg.style.color="green";
      msg.textContent="✅ Permintaan reset dikirim ke admin.";
    } else {
      msg.style.color="red";
      msg.textContent="❌ NPK tidak ditemukan.";
    }
  } catch(err){
    msg.style.color="red";
    msg.textContent="⚠️ Error: " + err.message;
  }
});

// Ganti password sendiri
document.getElementById("changeBtn").addEventListener("click", async () => {
  const npk = document.getElementById("forgotNPK").value.trim(); // FIXED
  const oldPass = document.getElementById("oldPass").value.trim();
  const newPass = document.getElementById("newPass").value.trim();
  const msg = document.getElementById("changeMsg");

  if(!npk || !oldPass || !newPass){
    msg.style.color="red"; 
    msg.textContent="⚠️ Isi semua field!"; 
    return;
  }

  try {
    const snapshot = await get(child(ref(db), `users/${npk}`));
    if(snapshot.exists()){
      const user = snapshot.val();
      if(user.password === oldPass){
        await set(ref(db, `users/${npk}/password`), newPass);
        msg.style.color="green"; 
        msg.textContent="✅ Password berhasil diganti!";
      } else {
        msg.style.color="red"; 
        msg.textContent="❌ Password lama salah!";
      }
    } else {
      msg.style.color="red"; 
      msg.textContent="❌ NPK tidak ditemukan.";
    }
  } catch(err){
    msg.style.color="red"; 
    msg.textContent="⚠️ Error: " + err.message;
  }
});


</script>

</body>
</html>









