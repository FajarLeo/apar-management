<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard APAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="Logo.png" type="image/png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
/* ======= GENERAL ======= */
body { font-family: Arial, sans-serif; background:#f0f2f5; margin:0; }

/* ======= SIDEBAR ======= */
.sidebar { height:100vh; width:250px; background:#343a40; color:white; padding-top:20px; position:fixed; transition:0.3s;}
.sidebar.collapsed { width:0; overflow:hidden; }
.sidebar a { color:white; display:block; padding:12px 20px; text-decoration:none; cursor:pointer; transition:0.3s; }
.sidebar a:hover, .sidebar a.active { background:#495057; color:#0cd8b6; }
.menu-icon { width:20px; height:20px; margin-right:8px; vertical-align:middle; filter:invert(1) brightness(0.9); opacity:0.85; transition:0.25s; }
.sidebar a:hover .menu-icon, .sidebar a.active .menu-icon { transform:scale(1.15); filter:invert(73%) sepia(74%) saturate(485%) hue-rotate(118deg) brightness(95%) contrast(90%); opacity:1; }

/* ======= MAIN CONTENT ======= */
.main-content { margin-left:250px; padding:80px 20px 20px 20px; min-height:90vh; transition:0.6s; }
.main-content.expanded { margin-left:0; }

/* ======= TOGGLE BUTTON ======= */
#toggleSidebar { position:fixed; top:5px; left:220px; z-index:3000; font-size:20px; font-weight:bold; background:#343a40; color:#fff; border:2px solid transparent; border-radius:6px; padding:1px 3px; cursor:pointer; transition:0.6s;}
#toggleSidebar:hover { background:#0cd8b6; color:#fff; border-color:#0cd8b6; transform:scale(1.1); box-shadow:0 0 10px rgba(12,216,182,0.7);}
#toggleSidebar.sidebar-collapsed { left:10px; }

/* ======= CARDS ======= */
#aparContainer { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:6px; }
.card { position:relative; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); min-height:180px; background-image:url("bg.jpg"); background-size:cover; background-position:center; transition:0.3s;}
.card h1 { position:absolute; bottom:10px; right:10px; padding:5px 12px; font-size:14px; color:#fff; font-weight:bold; border-radius:6px; text-transform:uppercase;}
.card h1.powder{background:#d9534f;} .card h1.foam{background:#0275d8;} .card h1.co2{background:#5cb85c;}
.status { text-transform:uppercase; padding:4px 8px; border-radius:4px; font-size:14px; color:white; display:inline-block; max-width:80px; text-align:center; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
.status.ready{background:#5cb85c;} .status.maintenance{background:#f0ad4e;} .status.expired{background:#d9534f;}
.ganti-apar { color:red; font-weight:bold; font-size:16px; animation: blinkRed 1s infinite alternate; margin-top:5px; }
@keyframes blinkRed { from {opacity:1;} to {opacity:0.4;} }
.card.expired-blink { animation:pulse 1.5s infinite alternate; }
@keyframes pulse { from{transform:scale(1); box-shadow:0 0 5px rgba(255,0,0,0.4);} to{transform:scale(1.03); box-shadow:0 0 15px rgba(255,0,0,0.8);} }

/* ======= MODAL ======= */
.modal-content { border-radius:14px; border:none; padding:0; background:#fff; box-shadow:0 8px 35px rgba(0,0,0,0.25); animation:modalFade 0.25s ease;}
@keyframes modalFade { from{transform:scale(0.93); opacity:0;} to{transform:scale(1); opacity:1;} }
.modal-header{background:#343a40; color:white; border-radius:14px 14px 0 0; padding:14px 20px;}
.modal-footer{padding:12px 18px; background:#eee; border-top:1px solid #ddd; border-radius:0 0 14px 14px;}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <img src="dsngroup1.PNG" alt="Logo" style="width:40%; display:block; margin:0 auto 20px;">
  <a id="menuDashboard" class="active" onclick="loadDashboard()"><img src="https://img.icons8.com/ios/50/computer--v1.png" class="menu-icon">Dashboard</a>
  <a id="menuMap" onclick="loadDistributionMap()"><img src="https://img.icons8.com/ios/50/worldwide-location--v1.png" class="menu-icon">Distribution Map</a>
  <a href="tfm_Input.html"><img src="https://img.icons8.com/ios/50/document--v1.png" class="menu-icon">Form Input</a>
</div>

<!-- Toggle Sidebar -->
<button id="toggleSidebar">◀</button>

<!-- Main Content -->
<div class="main-content">
  <!-- User Info -->
  <div id="userInfo">
    <strong id="usernameText">Guest</strong> |
    <span id="statusText" class="badge bg-secondary">Unknown</span>
    <button onclick="logout()" class="btn btn-sm btn-danger">Logout</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboardContent" style="display:none;">
    <h1>Dashboard Monitoring APAR</h1>
    <div id="lastUpdate">Update: -</div>
    <div class="controls">
      <input type="text" placeholder="Search..." class="form-control form-control-sm" style="max-width:170px;">
      <select id="filterJenis" class="form-select form-select-sm" style="width:100px;">
        <option value="all">All Type</option>
        <option value="powder">Powder</option>
        <option value="foam">Foam</option>
        <option value="co2">CO2</option>
      </select>
      <button id="btnSave"><img src="https://img.icons8.com/ios/50/save--v1.png"> Save</button>
      <button id="btnBackup"><img src="https://img.icons8.com/ios/50/data-backup.png"> Backup</button>
      <button id="btnExport"><img src="https://img.icons8.com/ios/50/export-excel.png"> Export</button>
      <button id="btnPrint"><img src="https://img.icons8.com/ios/50/print.png"> Print</button>
    </div>
    <div id="loader" style="text-align:center; padding:100px 0; display:none;">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Memuat data...</p>
    </div>
    <div id="aparContainer"></div>
  </div>

  <!-- Map -->
  <div id="distributionMapContent" style="display:none;">
    <h1>Peta Sebaran APAR</h1>
    <hr>
    <iframe src="tfm_map.html" width="100%" height="800" style="border:0;"></iframe>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
import { getDatabase, ref, onValue, set, push, remove, update, get } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

const firebaseConfig = { /* config kamu */ };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const aparRef = ref(db, "aparData");

const username = localStorage.getItem("userName") || "Guest";
const status = localStorage.getItem("userStatus") || "Unknown";
document.getElementById("usernameText").innerText = username;
document.getElementById("statusText").innerText = status;

window.logout = () => { localStorage.clear(); alert("Berhasil logout!"); location.href="index.html"; };

// Toggle Sidebar
const sidebar = document.querySelector(".sidebar");
const toggleBtn = document.getElementById("toggleSidebar");
const mainContent = document.querySelector(".main-content");
toggleBtn.addEventListener("click",()=>{
  sidebar.classList.toggle("collapsed");
  mainContent.classList.toggle("expanded");
  toggleBtn.classList.toggle("sidebar-collapsed");
  toggleBtn.innerText = sidebar.classList.contains("collapsed") ? "▶" : "◀";
});

// Tambah fungsi lain (renderDashboard, autoStatus, CRUD, Export Excel, dsb) sama persis
</script>

</body>
</html>
